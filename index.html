<!DOCTYPE html>
<html>
<head>
    <title>P2P –ß–∞—Ç —á–µ—Ä–µ–∑ GitHub</title>
    <style>
        body { font-family: Arial; padding: 20px; text-align: center; }
        #chat { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin: 10px auto; width: 80%; }
        input, button { padding: 10px; margin: 5px; }
        #status { padding: 10px; margin: 10px; }
        .online { background: #cfc; }
        .offline { background: #fcc; }
    </style>
</head>
<body>
    <h1>üåê P2P –ß–∞—Ç –Ω–∞ GitHub Pages</h1>
    
    <div id="status" class="offline">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
    
    <div>
        <p><strong>–í–∞—à ID:</strong> <span id="myId">...</span></p>
        <input type="text" id="peerId" placeholder="ID –¥—Ä—É–≥–∞">
        <button onclick="connect()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
        <button onclick="createInvite()">–°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</button>
    </div>
    
    <div id="chat"></div>
    <input type="text" id="message" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" style="width: 300px;">
    <button onclick="send()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script>
        // === –ü–†–û–°–¢–û–ô –†–ê–ë–û–ß–ò–ô P2P –ß–ê–¢ ===
        let peer = null;
        let conn = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PeerJS —Å –ø—É–±–ª–∏—á–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º
        function initPeer() {
            peer = new Peer({
                host: 'peerjs-server.herokuapp.com',
                port: 443,
                secure: true,
                config: {
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:stun1.l.google.com:19302' }
                    ]
                }
            });
            
            peer.on('open', (id) => {
                document.getElementById('myId').textContent = id;
                document.getElementById('status').className = 'online';
                document.getElementById('status').textContent = '‚úÖ –ì–æ—Ç–æ–≤! ID: ' + id;
                
                // –ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ —Å—Å—ã–ª–∫–µ
                const urlParams = new URLSearchParams(window.location.search);
                const inviteId = urlParams.get('invite');
                if (inviteId && inviteId !== id) {
                    document.getElementById('peerId').value = inviteId;
                    setTimeout(() => connect(), 1000);
                }
            });
            
            peer.on('connection', (connection) => {
                conn = connection;
                setupConnection();
                addMessage('–°–∏—Å—Ç–µ–º–∞', '‚úÖ –í—Ö–æ–¥—è—â–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ!');
            });
            
            peer.on('error', (err) => {
                console.error('–û—à–∏–±–∫–∞:', err);
                document.getElementById('status').className = 'offline';
                document.getElementById('status').textContent = '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
            });
        }
        
        function connect() {
            const friendId = document.getElementById('peerId').value.trim();
            if (!friendId) return alert('–í–≤–µ–¥–∏—Ç–µ ID –¥—Ä—É–≥–∞');
            
            conn = peer.connect(friendId, { reliable: true });
            setupConnection();
        }
        
        function setupConnection() {
            conn.on('open', () => {
                addMessage('–°–∏—Å—Ç–µ–º–∞', '‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
            });
            
            conn.on('data', (data) => {
                addMessage('–î—Ä—É–≥', data);
            });
            
            conn.on('close', () => {
                addMessage('–°–∏—Å—Ç–µ–º–∞', '‚ùå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
            });
        }
        
        function send() {
            const msg = document.getElementById('message').value;
            if (!msg || !conn) return;
            
            conn.send(msg);
            addMessage('–í—ã', msg);
            document.getElementById('message').value = '';
        }
        
        function addMessage(sender, text) {
            const chat = document.getElementById('chat');
            chat.innerHTML += `<div><b>${sender}:</b> ${text}</div>`;
            chat.scrollTop = chat.scrollHeight;
        }
        
        function createInvite() {
            const myId = document.getElementById('myId').textContent;
            const inviteLink = window.location.href.split('?')[0] + '?invite=' + myId;
            prompt('–û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –¥—Ä—É–≥—É:', inviteLink);
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = initPeer;
    </script>
</body>

</html>
